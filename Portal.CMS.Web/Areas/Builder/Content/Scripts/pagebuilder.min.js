function InitialiseWidgets(){$(".post-list-wrapper").length&&$.get("/Builder/Widget/RecentPostList",function(n){$(".post-list-wrapper").html(n)})}function InitialiseEditor(){$(".admin section").unbind();$(".admin .component-container").unbind();$(".admin .widget-wrapper").unbind();$(".admin section").click(function(){var t=$(this).attr("id"),n=ExtractSectionId($(this));$(this).find(".component-container").removeClass("selected");$(this).find(".widget-wrapper").removeClass("selected");$("#container-editor-"+n).fadeOut()}).children().click(function(){return!1});$(".admin .component-container").click(function(){var t=$(this).attr("id"),n=ExtractSectionId($(this));$(this).hasClass("selected")?($(this).removeClass("selected"),$("#container-editor-"+n).fadeOut()):($(".component-container").removeClass("selected"),$(".widget-wrapper").removeClass("selected"),$(".component-editor").fadeOut(200),$("#container-editor-"+n).fadeIn(200),$(this).addClass("selected"))}).children().click(function(){return!1});$(".admin .widget-wrapper").click(function(){var t=$(this).attr("id"),n=ExtractSectionId($(this));$(this).hasClass("selected")?($(this).removeClass("selected"),$("#container-editor-"+n).fadeOut()):($(".component-container").removeClass("selected"),$(".widget-wrapper").removeClass("selected"),$(".component-editor").fadeOut(200),$("#container-editor-"+n).fadeIn(200),$(this).addClass("selected"))}).children().click(function(){return!1});$(".admin section div.image").click(function(n){var t=n.target.id,i=ExtractSectionId($(this)),r="/Builder/Component/Image?pageSectionId="+i+"&elementId="+t+"&elementType=div";showModalEditor("Edit Image Properties",r)});$(".admin section img.image").click(function(n){var t=n.target.id,i=ExtractSectionId($(this)),r="/Builder/Component/Image?pageSectionId="+i+"&elementId="+t+"&elementType=img";showModalEditor("Edit Image Properties",r)});tinymce.init({selector:".admin section p, .admin section h1, .admin section h2, .admin section h3, .admin section h4, .admin section code",menubar:!1,inline:!0,plugins:["advlist textcolor colorpicker link"],toolbar:"bold italic underline | link | forecolor backcolor | delete",setup:function(n){n.addButton("delete",{icon:"trash",onclick:function(){DeleteInlineComponent(tinyMCE.activeEditor.id)}});n.on("change",function(){EditInlineText(tinyMCE.activeEditor.id,n.getContent())})}});tinymce.init({selector:".admin section a, .admin section .btn",menubar:!1,inline:!0,plugins:["advlist textcolor colorpicker link"],toolbar:"bold italic underline | link | forecolor backcolor | delete",setup:function(n){n.addButton("delete",{icon:"trash",onclick:function(){DeleteInlineComponent(tinyMCE.activeEditor.id)}});n.on("change",function(){EditInlineAnchor(tinyMCE.activeEditor.id,n.getContent())})}});tinymce.init({selector:".admin section .freestyle",menubar:!0,inline:!0,plugins:["advlist autolink lists link image charmap print preview anchor searchreplace visualblocks code fullscreen insertdatetime media table contextmenu paste textcolor colorpicker"],toolbar:"insertfile undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | forecolor backcolor | bullist numlist outdent indent | link image | delete",setup:function(n){n.addButton("delete",{icon:"trash",onclick:function(){DeleteInlineComponent(tinyMCE.activeEditor.id)}});n.on("change",function(){EditInlineFreestyle(tinyMCE.activeEditor.id,n.getContent())})}})}function InitialiseContainer(n){$("#"+n).droppable({tolerance:"intersect",activeClass:"ui-state-default",hoverClass:"ui-state-hover",greedy:"true",drop:function(n,t){DropComponent(this,n,t)}})}function InitialiseDroppables(){$("section").droppable({accept:function(){return PreventAppDrawerDrop()},tolerance:"pointer",activeClass:"ui-state-default",hoverClass:"ui-state-hover",drop:function(n,t){DropComponent(this,n,t)}});$(".component-container").droppable({accept:function(){return PreventAppDrawerDrop()},tolerance:"pointer",activeClass:"ui-state-default",hoverClass:"ui-state-hover",greedy:"true",drop:function(n,t){DropComponent(this,n,t)}})}function ExtractSectionId(n){var i=$(n).attr("id"),t=i.split("-");return t[t.length-1]}function EditInlineText(n,t){var i=n,r=ExtractSectionId($("#"+n)),u={pageSectionId:r,elementId:i,elementHtml:t};$.ajax({data:u,type:"POST",cache:!1,url:"/Builder/Component/Edit",success:function(n){n.State===!1&&(alert("Error: The Page has lost synchronisation. Reloading Page..."),location.reload())}})}function EditInlineFreestyle(n,t){var i=n,r=ExtractSectionId($("#"+n)),u={pageSectionId:r,elementId:i,elementHtml:t};$.ajax({data:u,type:"POST",cache:!1,url:"/Builder/Component/Freestyle",success:function(n){n.State===!1&&(alert("Error: The Page has lost synchronisation. Reloading Page..."),location.reload())}})}function EditInlineAnchor(n,t){var i=n,r=ExtractSectionId($("#"+n)),u=$("#"+i).attr("href"),f=$("#"+i).attr("target"),e={pageSectionId:r,elementId:i,elementHtml:t,elementHref:u,elementTarget:f};$.ajax({data:e,type:"POST",cache:!1,url:"/Builder/Component/Link",success:function(n){n.State===!1&&(alert("Error: The Page has lost synchronisation. Reloading Page..."),location.reload())}})}function DeleteInlineComponent(n){var t=n,i=ExtractSectionId($("#"+n)),r={pageSectionId:i,elementId:t};$("#"+t).remove();$.ajax({data:r,type:"POST",cache:!1,url:"/Builder/Component/Delete",success:function(n){n.State===!1&&(alert("Error: The Page has lost synchronisation. Reloading Page..."),location.reload())}})}function PreventAppDrawerDrop(){var n=$("#component-panel").offset(),u=$("#component-panel").width(),f=$("#component-panel").height(),t=n.top-$(document).scrollTop(),i=event.clientX,r=event.clientY;return i>=n.left&&i<=n.left+u&&r>=t&&r<=t+f?!1:!0}function DropComponent(n,t,i){var u=$(i.draggable).clone(),f=ExtractSectionId($(n)),r=u.attr("id"),e,o;r=r.replace("<sectionId>",f);r=r.replace("<componentStamp>",(new Date).valueOf());u.attr("id",r);$(n).append(u);$("#"+r).removeClass("ui-draggable");$("#"+r).removeClass("ui-draggable-handle");$("#"+r).unbind();ReplaceChildTokens(r,f);e=$("#"+r)[0].outerHTML;InitialiseEditor();InitialiseWidgets();u.hasClass("component-container")&&InitialiseContainer(r);o={pageSectionId:f,containerElementId:$(n).attr("id"),elementBody:e};$.ajax({data:o,type:"POST",cache:!1,url:"/Builder/Component/Add",success:function(n){n.State===!1&&(alert("Error: The Page has lost synchronisation. Reloading Page..."),location.reload())}})}function ReplaceChildTokens(n,t){$("#"+n).children().each(function(){var n=$(this).attr("id");n!=undefined&&(n=n.replace("<sectionId>",t),n=n.replace("<componentStamp>",(new Date).valueOf()),$(this).attr("id",n),ReplaceChildTokens(n,t))})}function ChangeOrder(){$("#page-wrapper").toggleClass("zoom");$("#page-wrapper").toggleClass("change-order");$("#page-wrapper.change-order").sortable({placeholder:"ui-state-highlight",helper:"clone"});$(".action-container.global").fadeOut();$(".action-container.section-order").fadeIn();$("#section-panel").hasClass("visible")&&($("#section-panel").slideUp(300),$("#section-panel").toggleClass("visible"));$("#component-panel").hasClass("visible")&&($("#component-panel").slideUp(300),$("#component-panel").toggleClass("visible"))}function SaveOrder(){var n=[],t=1;$("#page-wrapper .sortable").each(function(){var i=$(this).attr("data-section");n.push(t+"-"+i);t+=1});$("#order-list").val(n);$("#order-submit").click()}function ToggleSectionPanel(){$("#component-panel").hasClass("visible")&&($("#component-panel").slideUp(300),$("#component-panel").toggleClass("visible"));$("#section-panel").hasClass("visible")?($("#section-panel").slideUp(300),$("#section-panel").toggleClass("visible")):($("#section-panel").slideDown(300),$("#section-panel").toggleClass("visible"))}function ToggleComponentPanel(){$("#section-panel").hasClass("visible")&&($("#section-panel").slideUp(300),$("#section-panel").toggleClass("visible"));$("#component-panel").hasClass("visible")?($("#component-panel").slideUp(300),$("#component-panel").toggleClass("visible")):($("#component-panel").slideDown(300),$("#component-panel").toggleClass("visible"))}$(document).ready(function(){InitialiseWidgets();$("#page-wrapper.admin").length&&(InitialiseEditor(),InitialiseWidgets(),$(".admin .component-editor").click(function(){var r=$(this).attr("id"),t=ExtractSectionId($(this)),n=$("#section-"+t+" .component-container.selected:first").attr("id"),i;n===undefined&&(n=$("#section-"+t+" .widget-wrapper.selected:first").attr("id"));$("#"+n).remove();$(".component-editor").fadeOut(200);i={pageSectionId:t,elementId:n};$.ajax({data:i,type:"POST",cache:!1,url:"/Builder/Component/Delete",success:function(n){n.State===!1&&(alert("Error: The Page has lost synchronisation. Reloading Page..."),location.reload())}})}))});